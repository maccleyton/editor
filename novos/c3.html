<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Markdown A4</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr 1fr;
            gap: 20px;
            height: calc(100vh - 40px);
            transition: grid-template-columns 0.3s ease;
        }

        .main-container.collapsed {
            grid-template-columns: 0px 1fr 1fr;
        }

        .settings-panel, .editor-panel, .preview-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .settings-panel.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateX(-20px);
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .setting-group {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .setting-group:last-child {
            border-bottom: none;
        }

        .setting-group h3 {
            font-size: 14px;
            color: #667eea;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-item label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .setting-item input[type="color"] {
            width: 100%;
            height: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
        }

        .setting-item input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
        }

        .setting-item input[type="range"]::-webkit-slider-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .setting-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: 600;
            color: #667eea;
            font-size: 12px;
        }

        .export-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-markdown {
            background: #ff6b6b;
            color: white;
        }

        .btn-html {
            background: #4ecdc4;
            color: white;
        }

        .btn-pdf {
            background: #f39c12;
            color: white;
        }

        .btn-print {
            background: #2ecc71;
            color: white;
        }

        .btn-reset {
            width: 100%;
            background: #ff6b6b;
            color: white;
            margin-top: 10px;
        }

        .toggle-settings {
            position: fixed;
            left: 20px;
            top: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-settings:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .toggle-settings:active {
            transform: scale(0.95);
        }

        .main-container.collapsed .toggle-settings {
            left: 20px;
        }

        .btn:active {
            transform: translateY(0);
        }

        textarea {
            flex: 1;
            border: none;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            line-height: 1.6;
        }

        .preview-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            page-break-after: always;
            position: relative;
            transform-origin: top center;
            transition: transform 0.2s ease;
        }

        .page:last-child {
            margin-bottom: 0;
        }

        /* Estilos base do Markdown */
        .page h1 {
            font-size: 32px;
            margin-bottom: 20px;
            border-bottom: 3px solid;
            padding-bottom: 10px;
        }

        .page h2 {
            font-size: 26px;
            margin-bottom: 16px;
            border-bottom: 2px solid;
            padding-bottom: 8px;
        }

        .page h3 {
            font-size: 22px;
            margin-bottom: 12px;
        }

        .page h4 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .page h5 {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .page h6 {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .page p {
            margin-bottom: 16px;
            color: #333;
            text-align: justify;
        }

        .page code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #e83e8c;
        }

        .page pre {
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 16px;
            border-left: 4px solid #667eea;
        }

        .page pre code {
            background: none;
            padding: 0;
            font-size: 14px;
        }

        .page table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .page table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .page table th,
        .page table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 200px;
        }

        .page table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        .page table tbody tr:hover {
            background: #f0f0f0;
        }

        .page ul, .page ol {
            margin-bottom: 16px;
            padding-left: 30px;
        }

        .page li {
            margin-bottom: 8px;
        }

        .page blockquote {
            border-left: 4px solid #667eea;
            padding-left: 16px;
            margin: 16px 0;
            color: #666;
            font-style: italic;
            background: #f9f9f9;
            padding: 12px 16px;
            border-radius: 4px;
        }

        .page img {
            max-width: 100%;
            height: auto;
            margin: 16px 0;
            border-radius: 6px;
        }

        .page a {
            color: #667eea;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s;
        }

        .page a:hover {
            border-bottom-color: #667eea;
        }

        .page hr {
            border: none;
            border-top: 2px solid #e0e0e0;
            margin: 24px 0;
        }

        .katex-display {
            margin: 20px 0;
            overflow-x: auto;
            padding: 16px;
            border-radius: 6px;
            max-width: 100%;
        }

        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }
            .settings-panel, .editor-panel, .panel-header, .toggle-settings {
                display: none !important;
            }
            .main-container {
                display: block;
                transform: none !important;
            }
            .preview-panel {
                box-shadow: none;
            }
            .preview-container {
                padding: 0;
                background: white;
                overflow: visible;
            }
            .page {
                width: 210mm;
                height: 297mm;
                margin: 0;
                box-shadow: none;
                page-break-after: always;
                break-after: page;
                transform: none !important;
            }
            .page:last-child {
                page-break-after: auto;
            }
        }
    </style>
</head>
<body>
    <button class="toggle-settings" onclick="toggleSettings()" title="Mostrar/Ocultar Configurações">
        ⚙️
    </button>
    
    <div class="main-container" id="main-container">
        <!-- Painel de Configurações -->
        <div class="settings-panel">
            <div class="panel-header">
                <span>⚙️ Configurações</span>
            </div>
            <div class="settings-content">
                <!-- Cores dos Títulos -->
                <div class="setting-group">
                    <h3>🎨 Cores dos Títulos</h3>
                    <div class="setting-item">
                        <label>H1</label>
                        <input type="color" id="h1-color" value="#1a1a1a">
                    </div>
                    <div class="setting-item">
                        <label>H2</label>
                        <input type="color" id="h2-color" value="#2563eb">
                    </div>
                    <div class="setting-item">
                        <label>H3</label>
                        <input type="color" id="h3-color" value="#059669">
                    </div>
                    <div class="setting-item">
                        <label>H4</label>
                        <input type="color" id="h4-color" value="#7c3aed">
                    </div>
                    <div class="setting-item">
                        <label>H5</label>
                        <input type="color" id="h5-color" value="#dc2626">
                    </div>
                    <div class="setting-item">
                        <label>H6</label>
                        <input type="color" id="h6-color" value="#ea580c">
                    </div>
                </div>

                <!-- Cores de Blocos -->
                <div class="setting-group">
                    <h3>🎨 Cores de Blocos</h3>
                    <div class="setting-item">
                        <label>Fundo Código</label>
                        <input type="color" id="code-bg-color" value="#e3f2fd">
                    </div>
                    <div class="setting-item">
                        <label>Texto Código</label>
                        <input type="color" id="code-text-color" value="#1e3a8a">
                    </div>
                    <div class="setting-item">
                        <label>Fundo LaTeX</label>
                        <input type="color" id="latex-bg-color" value="#f3e8ff">
                    </div>
                </div>

                <!-- Margens da Página -->
                <div class="setting-group">
                    <h3>📏 Margens da Página</h3>
                    <div class="setting-item">
                        <label>Margem (mm)<span class="setting-value" id="margin-value">25</span></label>
                        <input type="range" id="margin" min="10" max="40" value="25">
                    </div>
                </div>

                <!-- Espaçamento do Texto -->
                <div class="setting-group">
                    <h3>📐 Espaçamento</h3>
                    <div class="setting-item">
                        <label>Entre Linhas<span class="setting-value" id="line-height-value">1.8</span></label>
                        <input type="range" id="line-height" min="1" max="3" step="0.1" value="1.8">
                    </div>
                    <div class="setting-item">
                        <label>Entre Letras (px)<span class="setting-value" id="letter-spacing-value">0</span></label>
                        <input type="range" id="letter-spacing" min="-1" max="5" step="0.5" value="0">
                    </div>
                    <div class="setting-item">
                        <label>Entre Palavras (px)<span class="setting-value" id="word-spacing-value">0</span></label>
                        <input type="range" id="word-spacing" min="0" max="10" step="1" value="0">
                    </div>
                </div>

                <!-- Zoom -->
                <div class="setting-group">
                    <h3>🔍 Zoom</h3>
                    <div class="setting-item">
                        <label>Nível de Zoom (%)<span class="setting-value" id="zoom-value">100</span></label>
                        <input type="range" id="zoom" min="25" max="200" step="5" value="100">
                    </div>
                </div>

                <button class="btn btn-reset" onclick="resetSettings()">🔄 Resetar Configurações</button>
            </div>
        </div>

        <!-- Painel do Editor -->
        <div class="editor-panel">
            <div class="panel-header">
                <span>📝 Editor Markdown</span>
            </div>
            <textarea id="markdown-input" placeholder="Digite seu markdown aqui...
# Título Principal (H1)

## Seção 1 (H2)

Texto com **negrito** e *itálico*.

### Subsecção (H3)

#### Tópico (H4)

##### Subtópico (H5)

###### Detalhe (H6)

Código inline: `console.log()`

```javascript
function hello() {
    console.log('Hello World!');
}
```

Equação inline: $E = mc^2$

$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

| Nome | Idade | Cidade |
|------|-------|--------|
| Ana | 25 | SP |
| João | 30 | RJ |

## Nova Seção (H2)

Cada H1 ou H2 inicia uma nova página!"></textarea>
        </div>

        <!-- Painel de Visualização -->
        <div class="preview-panel">
            <div class="panel-header">
                <span>👁️ Visualização A4</span>
                <div class="export-buttons">
                    <button class="btn btn-markdown" onclick="exportMarkdown()" title="Exportar como Markdown">
                        📝 MD
                    </button>
                    <button class="btn btn-html" onclick="exportHTML()" title="Exportar como HTML">
                        🌐 HTML
                    </button>
                    <button class="btn btn-pdf" onclick="exportPDF()" title="Exportar como PDF">
                        📄 PDF
                    </button>
                    <button class="btn btn-print" onclick="printDocument()" title="Imprimir">
                        🖨️ Print
                    </button>
                </div>
            </div>
            <div class="preview-container" id="preview"></div>
        </div>
    </div>

    <script>
        const input = document.getElementById('markdown-input');
        const preview = document.getElementById('preview');

        // Configurações padrão
        const settings = {
            h1Color: '#1a1a1a',
            h2Color: '#2563eb',
            h3Color: '#059669',
            h4Color: '#7c3aed',
            h5Color: '#dc2626',
            h6Color: '#ea580c',
            codeBgColor: '#e3f2fd',
            codeTextColor: '#1e3a8a',
            latexBgColor: '#f3e8ff',
            margin: 25,
            lineHeight: 1.8,
            letterSpacing: 0,
            wordSpacing: 0,
            zoom: 100
        };

        // Configurar marked
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: true,
            gfm: true
        });

        function renderLatex(text) {
            // Proteger blocos de código antes de processar LaTeX
            const codeBlocks = [];
            text = text.replace(/```[\s\S]*?```/g, (match) => {
                codeBlocks.push(match);
                return `__CODEBLOCK_${codeBlocks.length - 1}__`;
            });

            // Proteger tabelas antes de processar LaTeX
            const tables = [];
            text = text.replace(/^\|.+\|$/gm, (match) => {
                tables.push(match);
                return `__TABLE_${tables.length - 1}__`;
            });

            // LaTeX em bloco: $$...$$ (multilinhas)
            text = text.replace(/\$\$\s*\n([\s\S]+?)\n\s*\$\$/g, (match, formula) => {
                try {
                    return '\n' + katex.renderToString(formula.trim(), { displayMode: true, throwOnError: false }) + '\n';
                } catch (e) {
                    console.error('Erro LaTeX bloco:', e);
                    return match;
                }
            });

            // LaTeX em bloco: $$..$$ (mesma linha)
            text = text.replace(/\$\$((?:[^\$]|\\\$)+?)\$\$/g, (match, formula) => {
                try {
                    return katex.renderToString(formula.trim(), { displayMode: true, throwOnError: false });
                } catch (e) {
                    console.error('Erro LaTeX bloco inline:', e);
                    return match;
                }
            });

            // LaTeX inline: $...$
            text = text.replace(/(?<!\\)\$(?!\$)([^\$\n]+?)(?<!\\)\$(?!\$)/g, (match, formula) => {
                try {
                    return katex.renderToString(formula.trim(), { displayMode: false, throwOnError: false });
                } catch (e) {
                    console.error('Erro LaTeX inline:', e);
                    return match;
                }
            });

            // Restaurar tabelas
            text = text.replace(/__TABLE_(\d+)__/g, (match, index) => {
                return tables[parseInt(index)];
            });

            // Restaurar blocos de código
            text = text.replace(/__CODEBLOCK_(\d+)__/g, (match, index) => {
                return codeBlocks[parseInt(index)];
            });

            return text;
        }

        function applySettings() {
            const pages = document.querySelectorAll('.page');
            
            // Aplicar zoom nas páginas individualmente
            const zoomScale = settings.zoom / 100;
            
            pages.forEach(page => {
                page.style.transform = `scale(${zoomScale})`;
                page.style.padding = `${settings.margin}mm`;
                
                page.querySelectorAll('h1').forEach(el => {
                    el.style.color = settings.h1Color;
                    el.style.borderBottomColor = settings.h1Color;
                });
                page.querySelectorAll('h2').forEach(el => {
                    el.style.color = settings.h2Color;
                    el.style.borderBottomColor = settings.h2Color;
                });
                page.querySelectorAll('h3').forEach(el => el.style.color = settings.h3Color);
                page.querySelectorAll('h4').forEach(el => el.style.color = settings.h4Color);
                page.querySelectorAll('h5').forEach(el => el.style.color = settings.h5Color);
                page.querySelectorAll('h6').forEach(el => el.style.color = settings.h6Color);
                
                page.querySelectorAll('pre').forEach(el => {
                    el.style.background = settings.codeBgColor;
                    el.style.color = settings.codeTextColor;
                });
                
                page.querySelectorAll('.katex-display').forEach(el => {
                    el.style.background = settings.latexBgColor;
                });
                
                page.querySelectorAll('p, li').forEach(el => {
                    el.style.lineHeight = settings.lineHeight;
                    el.style.letterSpacing = `${settings.letterSpacing}px`;
                    el.style.wordSpacing = `${settings.wordSpacing}px`;
                });
            });
        }

        function splitIntoPages(html) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            
            const pages = [];
            let currentPage = document.createElement('div');
            currentPage.className = 'page';
            
            const children = Array.from(tempDiv.children);
            
            for (let i = 0; i < children.length; i++) {
                const el = children[i];
                const tagName = el.tagName.toLowerCase();
                
                if ((tagName === 'h1' || tagName === 'h2') && currentPage.children.length > 0) {
                    pages.push(currentPage);
                    currentPage = document.createElement('div');
                    currentPage.className = 'page';
                }
                
                currentPage.appendChild(el.cloneNode(true));
            }
            
            if (currentPage.children.length > 0) {
                pages.push(currentPage);
            }
            
            return pages;
        }

        function renderMarkdown() {
            try {
                let text = input.value;
                
                // Processar LaTeX antes do Markdown
                text = renderLatex(text);
                
                // Converter Markdown para HTML
                let html = marked.parse(text);
                
                // Dividir em páginas
                const pages = splitIntoPages(html);
                
                // Limpar preview e adicionar páginas
                preview.innerHTML = '';
                pages.forEach(page => {
                    preview.appendChild(page);
                });
                
                // Aplicar highlight nos códigos
                preview.querySelectorAll('pre code').forEach(block => {
                    try {
                        hljs.highlightElement(block);
                    } catch (e) {
                        console.error('Erro no highlight:', e);
                    }
                });

                applySettings();
            } catch (error) {
                console.error('Erro ao renderizar markdown:', error);
                preview.innerHTML = '<div class="page"><p style="color: red;">Erro ao renderizar o documento. Verifique o console para detalhes.</p></div>';
            }
        }

        // Event listeners para os controles
        document.getElementById('h1-color').addEventListener('input', (e) => {
            settings.h1Color = e.target.value;
            applySettings();
        });

        document.getElementById('h2-color').addEventListener('input', (e) => {
            settings.h2Color = e.target.value;
            applySettings();
        });

        document.getElementById('h3-color').addEventListener('input', (e) => {
            settings.h3Color = e.target.value;
            applySettings();
        });

        document.getElementById('h4-color').addEventListener('input', (e) => {
            settings.h4Color = e.target.value;
            applySettings();
        });

        document.getElementById('h5-color').addEventListener('input', (e) => {
            settings.h5Color = e.target.value;
            applySettings();
        });

        document.getElementById('h6-color').addEventListener('input', (e) => {
            settings.h6Color = e.target.value;
            applySettings();
        });

        document.getElementById('code-bg-color').addEventListener('input', (e) => {
            settings.codeBgColor = e.target.value;
            applySettings();
        });

        document.getElementById('code-text-color').addEventListener('input', (e) => {
            settings.codeTextColor = e.target.value;
            applySettings();
        });

        document.getElementById('latex-bg-color').addEventListener('input', (e) => {
            settings.latexBgColor = e.target.value;
            applySettings();
        });

        document.getElementById('margin').addEventListener('input', (e) => {
            settings.margin = e.target.value;
            document.getElementById('margin-value').textContent = e.target.value;
            applySettings();
        });

        document.getElementById('line-height').addEventListener('input', (e) => {
            settings.lineHeight = e.target.value;
            document.getElementById('line-height-value').textContent = e.target.value;
            applySettings();
        });

        document.getElementById('letter-spacing').addEventListener('input', (e) => {
            settings.letterSpacing = e.target.value;
            document.getElementById('letter-spacing-value').textContent = e.target.value;
            applySettings();
        });

        document.getElementById('word-spacing').addEventListener('input', (e) => {
            settings.wordSpacing = e.target.value;
            document.getElementById('word-spacing-value').textContent = e.target.value;
            applySettings();
        });

        document.getElementById('zoom').addEventListener('input', (e) => {
            settings.zoom = e.target.value;
            document.getElementById('zoom-value').textContent = e.target.value;
            applySettings();
        });

        function resetSettings() {
            document.getElementById('h1-color').value = '#1a1a1a';
            document.getElementById('h2-color').value = '#2563eb';
            document.getElementById('h3-color').value = '#059669';
            document.getElementById('h4-color').value = '#7c3aed';
            document.getElementById('h5-color').value = '#dc2626';
            document.getElementById('h6-color').value = '#ea580c';
            document.getElementById('code-bg-color').value = '#e3f2fd';
            document.getElementById('code-text-color').value = '#1e3a8a';
            document.getElementById('latex-bg-color').value = '#f3e8ff';
            document.getElementById('margin').value = 25;
            document.getElementById('line-height').value = 1.8;
            document.getElementById('letter-spacing').value = 0;
            document.getElementById('word-spacing').value = 0;
            document.getElementById('zoom').value = 100;
            
            settings.h1Color = '#1a1a1a';
            settings.h2Color = '#2563eb';
            settings.h3Color = '#059669';
            settings.h4Color = '#7c3aed';
            settings.h5Color = '#dc2626';
            settings.h6Color = '#ea580c';
            settings.codeBgColor = '#e3f2fd';
            settings.codeTextColor = '#1e3a8a';
            settings.latexBgColor = '#f3e8ff';
            settings.margin = 25;
            settings.lineHeight = 1.8;
            settings.letterSpacing = 0;
            settings.wordSpacing = 0;
            settings.zoom = 100;
            
            document.getElementById('margin-value').textContent = 25;
            document.getElementById('line-height-value').textContent = 1.8;
            document.getElementById('letter-spacing-value').textContent = 0;
            document.getElementById('word-spacing-value').textContent = 0;
            document.getElementById('zoom-value').textContent = 100;
            
            applySettings();
        }

        function exportMarkdown() {
            const text = input.value;
            const blob = new Blob([text], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'documento.md';
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportHTML() {
            const htmlContent = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documento Exportado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; padding: 20px; }
        .page { width: 210mm; min-height: 297mm; background: white; margin: 0 auto 20px; padding: ${settings.margin}mm; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        h1 { font-size: 32px; margin-bottom: 20px; color: ${settings.h1Color}; border-bottom: 3px solid ${settings.h1Color}; padding-bottom: 10px; }
        h2 { font-size: 26px; margin-bottom: 16px; color: ${settings.h2Color}; border-bottom: 2px solid ${settings.h2Color}; padding-bottom: 8px; }
        h3 { font-size: 22px; margin-bottom: 12px; color: ${settings.h3Color}; }
        h4 { font-size: 18px; margin-bottom: 10px; color: ${settings.h4Color}; }
        h5 { font-size: 16px; margin-bottom: 8px; color: ${settings.h5Color}; }
        h6 { font-size: 14px; margin-bottom: 8px; color: ${settings.h6Color}; }
        p, li { line-height: ${settings.lineHeight}; letter-spacing: ${settings.letterSpacing}px; word-spacing: ${settings.wordSpacing}px; margin-bottom: 16px; color: #333; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; }
        pre { background: ${settings.codeBgColor}; color: ${settings.codeTextColor}; padding: 16px; border-radius: 6px; margin-bottom: 16px; }
        .katex-display { background: ${settings.latexBgColor}; padding: 16px; border-radius: 6px; margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
        table thead { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        th, td { border: 1px solid #ddd; padding: 12px; }
        @media print { body { background: white; padding: 0; } .page { margin: 0; box-shadow: none; page-break-after: always; } }
    </style>
</head>
<body>${preview.innerHTML}</body>
</html>`;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'documento.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportPDF() {
            // Criar cópia do preview sem zoom
            const element = preview.cloneNode(true);
            
            // Aplicar estilos das configurações na cópia
            const pages = element.querySelectorAll('.page');
            pages.forEach(page => {
                page.style.padding = `${settings.margin}mm`;
                page.style.margin = '0';
                page.style.boxShadow = 'none';
            });
            
            const opt = {
                margin: 0,
                filename: 'documento.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true,
                    windowWidth: 794, // Largura A4 em pixels (210mm)
                    windowHeight: 1123 // Altura A4 em pixels (297mm)
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            html2pdf().set(opt).from(element).save();
        }

        function printDocument() {
            window.print();
        }

        function toggleSettings() {
            const container = document.getElementById('main-container');
            const settingsPanel = document.querySelector('.settings-panel');
            container.classList.toggle('collapsed');
            settingsPanel.classList.toggle('hidden');
        }

        input.addEventListener('input', renderMarkdown);
        renderMarkdown();
    </script>
</body>
</html>